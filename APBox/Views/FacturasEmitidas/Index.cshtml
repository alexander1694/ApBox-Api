@model API.Models.Facturas.FacturasEmitidasModel

@{
    ViewBag.Title = "Facturas Emitidas";
}

<div class="card card-flush">
    <div class="card-header align-items-center py-5 gap-2 gap-md-5">
        <div id="card-title">
            <!--begin::Export buttons-->
            <div id="kt_datatable_example_1_export" class="d-none"></div>
            <!--end::Export buttons-->
        </div>
        </div>
        
            <div class="card-body pt-0">

                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()

                <div class="form">
                    @Html.ValidationSummary(true, "", new { @class = "label-blue-alt" })

                    @Html.HiddenFor(model => model.SucursalId)

                    <div class="sub-title">
                        <span class="fa fa-bars text-muted"></span> Periodos de Tiempo
                    </div>
                    <div class="row">
                        <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-3">
                                <span class="input-group-addon">Fecha Inicial</span>
                                @Html.EditorFor(model => model.FechaInicial, new { htmlAttributes = new { @class = "form-control mb-2" } })
                                @Html.ValidationMessageFor(model => model.FechaInicial, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-3">                     
                                <span class="input-group-addon">Fecha Final</span>
                                @Html.EditorFor(model => model.FechaFinal, new { htmlAttributes = new { @class = "form-control mb-2" } })
                                @Html.ValidationMessageFor(model => model.FechaFinal, "", new { @class = "text-danger" })
                        </div>
                        </div>
                        <div class="clearfix"></div>
                        <hr />
                        <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-3 pull-right">
                            <button type="submit" class="btn btn-success">Filtrar</button>
                        </div>
                        <table class="table align-middle rounded table-row-dashed fs-6 g-5" id="kt_datatable">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase">
                                    <th class="min-w-100px">
                                        Receptor
                                    </th>
                                 
                                    <th class="min-w-100px">
                                        UUID
                                    </th>
                                    <th class="min-w-100px">
                                        Serie
                                    </th>
                                    <th class="min-w-100px">
                                        Folio
                                    </th>
                                    <th class="min-w-100px">
                                        Fecha
                                    </th>
                                    <th class="min-w-100px">
                                        Moneda
                                    </th>
                                    <th class="min-w-100px">
                                        Tipo de Cambio
                                    </th>
                                    <th class="min-w-100px">
                                        Subtotal
                                    </th>
                                    <th class="min-w-100px">
                                        Descuento
                                    </th>
                                    <th class="min-w-100px">
                                        Total Impuestos Trasladados
                                    </th>
                                    <th class="min-w-100px">
                                        Total Impuestos Retenidos
                                    </th>
                                    <th class="min-w-100px">
                                        Total
                                    </th>
                                    <th class="min-w-100px">
                                        Tipo Comprobante
                                    </th>
                                    <th>Opciones</th>
                                </tr>
                            </thead>

                            <tbody>
                                @foreach (var item in Model.FacturasEmitidas)
                                {
                                    <tr class="odd">
                                        <td>
                                
                                            @Html.DisplayFor(modelItem => item.Receptor.RazonSocial)
                                            
                                        </td>
                                       
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Uuid)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Serie)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Folio)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Fecha)
                                        </td>
                                        <td class="text-center">
                                            @Html.DisplayFor(modelItem => item.Moneda)
                                        </td>
                                        <td class="text-center">
                                            @item.TipoCambio
                                        </td>
                                        <td class="text-right">
                                            @item.Subtotal.ToString("c")
                                        </td>
                                        <td class="text-right">
                                            @item.Descuento
                                        </td>
                                        <td class="text-right">
                                            @item.TotalImpuestosTrasladados
                                        </td>
                                        <td class="text-right">
                                            @item.TotalImpuestosRetenidos
                                        </td>
                                        <td class="text-right">
                                            @item.Total.ToString("c")
                                        </td>
                                        <td class="text-center">
                                            @item.TipoComprobante
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-group">
                                                <!--begin::Action=-->
                                                <a href="#" class="btn btn-sm btn-light btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                    Acciones <i class="fa-solid fa-chevron-down"></i>
                                                </a>
                                                <!--begin::Menu-->
                                                <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">

                                                    @{
                                                        var db = new APBox.Context.APBoxContext();
                                                        var cPorte = db.ComplementoCartaPortes.Where(cp=> cp.FacturaEmitidaId == item.Id).FirstOrDefault();
                                                        var cPagos = db.ComplementosPago.Where(p=> p.FacturaEmitidaId == item.Id).FirstOrDefault();
                                                        var cCfdi = db.ComprobantesCfdi.Where(c=> c.FacturaEmitidaId == item.Id).FirstOrDefault();
                                                        if (cPorte != null)
                                                        {
                                                            <div class="menu-item px-3">@Html.ActionLink("Acuse", "DownloadAcuse", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                        }
                                                        else if (cPagos != null)
                                                        {
                                                            <div class="menu-item px-3">@Html.ActionLink("Acuse", "DownloadAcuse", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                        }
                                                        else if (cCfdi != null)
                                                        {
                                                            <div class="menu-item px-3">@Html.ActionLink("Acuse", "DownloadAcuse", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                        }
                                                        else
                                                        {
                                                            <div class="menu-item px-3">@Html.ActionLink("PDF", "DownloadPdf", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                            <div class="menu-item px-3">@Html.ActionLink("XML", "DownloadXml", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                            <div class="menu-item px-3">@Html.ActionLink("Cancelar", "Cancelar", new { id = item.Id }, new { @class = "menu-link px-3" })</div>
                                                        }
                                                    }

                                                </div>
                                            </div>
                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>
                    }
                </div>
 
        </div>
        
